<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/photos.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
    <title>Photography - Sasha Bagrov</title>
</head>
<body data-theme="light">
    <!-- Page transition overlay -->
    <div class="page-transition"></div>

    <!-- Navigation header -->
    <nav class="main-nav visible" id="mainNav">
        <div class="nav-content">
            <div class="nav-logo">SB</div>
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="/" class="nav-link">
                    <span>Home</span>
                    <div class="nav-underline"></div>
                </a>
                <a href="/projects" class="nav-link">
                    <span>Projects</span>
                    <div class="nav-underline"></div>
                </a>
                <a href="/skills" class="nav-link">
                    <span>Skills</span>
                    <div class="nav-underline"></div>
                </a>
                <a href="/photos" class="nav-link active">
                    <span>Photography</span>
                    <div class="nav-underline"></div>
                </a>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                <span class="material-symbols-outlined">dark_mode</span>
            </button>
        </div>
    </nav>

    <main class="content-page">
        <section class="page-hero">
            <h1 data-scroll>Photography</h1>
            <p data-scroll>Around London</p>
        </section>

        <div class="photo-grid" id="photoGrid">
            <!-- Photos will be dynamically loaded here -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Sasha Bagrov. All rights reserved.</p>
    </footer>

    <!-- Modal for full-size images -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <img id="modalImage" src="" alt="">
            <div class="modal-info">
                <h3 id="modalTitle"></h3>
                <p id="modalCopyright"></p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script>
        // Dynamically load images from Firebase Storage
        async function loadPhotos() {
            const photoGrid = document.getElementById('photoGrid');
            const layoutClasses = ['', 'large', 'wide', 'tall']; // Variety in layout

            try {
                // Fetch the list of images from the API
                const response = await fetch('/api/images');
                if (!response.ok) {
                    throw new Error('Failed to fetch images');
                }

                const data = await response.json();
                const images = data.images;

                if (!images || images.length === 0) {
                    photoGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem;">No images found</p>';
                    return;
                }

                // Create photo items for each image
                images.forEach((image, index) => {
                    // Determine layout class for variety
                    const layoutClass = layoutClasses[index % layoutClasses.length];

                    // Determine quality and width based on layout
                    const isLarge = layoutClass === 'large' || layoutClass === 'wide';
                    const width = isLarge ? 800 : 600;
                    const quality = isLarge ? 85 : 80;

                    // Create photo item
                    const photoItem = document.createElement('div');
                    photoItem.className = `photo-item ${layoutClass}`;
                    photoItem.setAttribute('data-title', image.title);
                    photoItem.setAttribute('data-copyright', 'This image is for display purposes only. All rights reserved. Not to be used without explicit permission.');

                    photoItem.innerHTML = `
                        <img loading="lazy" src="/images/${image.id}?w=${width}&q=${quality}" alt="${image.title}">
                        <div class="photo-overlay">
                            <div class="photo-details">
                                <h3>${image.title}</h3>
                            </div>
                        </div>
                    `;

                    photoGrid.appendChild(photoItem);
                });

                // Re-attach modal listeners after loading photos
                attachModalListeners();

            } catch (error) {
                console.error('Error loading photos:', error);
                photoGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem;">Error loading images. Please try again later.</p>';
            }
        }

        function attachModalListeners() {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalCopyright = document.getElementById('modalCopyright');

            document.querySelectorAll('.photo-item').forEach(item => {
                item.addEventListener('click', function() {
                    const img = this.querySelector('img');
                    const title = this.getAttribute('data-title');
                    const copyright = this.getAttribute('data-copyright');

                    const originalSrc = img.src.split('?')[0];
                    const highQualitySrc = originalSrc + '?w=1200&q=95';

                    modalImg.src = highQualitySrc;
                    modalTitle.textContent = title;
                    modalCopyright.textContent = copyright;
                    modal.style.display = 'block';
                });
            });
        }

        // Load photos when page loads
        loadPhotos();

        // Modal close functionality
        const modal = document.getElementById('imageModal');
        const closeModal = document.querySelector('.modal-close');

        closeModal.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                modal.style.display = 'none';
            }
        });
    </script>
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
