<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
    <title>Admin Login - Sasha Bagrov</title>
</head>
<body>
    <div class="container">
        <div class="admin-login">
            <div class="login-header">
                <span class="material-symbols-outlined">admin_panel_settings</span>
                <h1>Admin Login</h1>
                <p>Sign in with Google to access the admin panel</p>
            </div>
            
            <div class="login-form">
                <div id="google-signin-button"></div>
                <div id="login-status"></div>
            </div>
            
            <div class="nav-back">
                <a href="/">
                    <span class="material-symbols-outlined">arrow_back</span>
                    Back to Portfolio
                </a>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "{{ config.FIREBASE_API_KEY }}",
            authDomain: "{{ config.FIREBASE_AUTH_DOMAIN }}",
            projectId: "{{ config.FIREBASE_PROJECT_ID }}",
            storageBucket: "{{ config.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "{{ config.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "{{ config.FIREBASE_APP_ID }}"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Create Google Sign-in button
        const signInButton = document.createElement('button');
        signInButton.className = 'google-signin-btn';
        signInButton.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 18 18">
                <path fill="#4285F4" d="M17.64 9.2c0-.6-.05-1.18-.15-1.73H9v3.28h4.84c-.21 1.12-.84 2.07-1.79 2.71v2.23h2.9c1.69-1.56 2.69-3.85 2.69-6.49z"/>
                <path fill="#34A853" d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.9-2.23c-.81.54-1.84.86-3.06.86-2.35 0-4.34-1.59-5.05-3.73H.96v2.3C2.44 15.98 5.48 18 9 18z"/>
                <path fill="#FBBC05" d="M3.95 10.72c-.18-.54-.28-1.12-.28-1.72s.1-1.18.28-1.72V4.98H.96A8.996 8.996 0 0 0 0 9c0 1.45.35 2.82.96 4.02l2.99-2.3z"/>
                <path fill="#EA4335" d="M9 3.58c1.32 0 2.51.45 3.44 1.34l2.58-2.58C13.46.92 11.43 0 9 0 5.48 0 2.44 2.02.96 4.98l2.99 2.3C4.66 5.17 6.65 3.58 9 3.58z"/>
            </svg>
            Sign in with Google
        `;

        document.getElementById('google-signin-button').appendChild(signInButton);

        signInButton.addEventListener('click', async () => {
            const statusDiv = document.getElementById('login-status');
            statusDiv.innerHTML = 'Signing in...';
            
            try {
                const result = await signInWithPopup(auth, provider);
                const idToken = await result.user.getIdToken();
                
                // Send token to server for verification
                const response = await fetch('/admin/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ idToken: idToken })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.innerHTML = 'Login successful! Redirecting...';
                    window.location.href = '/admin';
                } else {
                    statusDiv.innerHTML = `Login failed: ${data.error}`;
                }
            } catch (error) {
                console.error('Login error:', error);
                statusDiv.innerHTML = `Login failed: ${error.message}`;
            }
        });
    </script>
</body>
</html>